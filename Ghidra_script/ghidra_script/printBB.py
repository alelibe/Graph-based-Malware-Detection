#TODO write a description for this script
#@author 
#@category _NEW_
#@keybinding 
#@menupath 
#@toolbar 


from ghidra.program.model.block import BasicBlockModel
from ghidra.util.task import TaskMonitor
from ghidra.util.task import ConsoleTaskMonitor

# scorro le istruzioni che sono nel blocco
def print_disassembly(block):
    listing = currentProgram.getListing()
    ins_iter = listing.getInstructions(block, True)

    while ins_iter.hasNext():
        ins = ins_iter.next()
        print "{} {}".format(ins.getAddressString(False, True), ins)



bbm = BasicBlockModel(currentProgram)
monitor = ConsoleTaskMonitor()

funcs = currentProgram.getFunctionManager().getFunctions(True)
for f in funcs:
	if "onCreate" in str(f.getName()):
		body = f.getBody()

# prendo le istruzioni della funzione selezionata
# listing = currentProgram.getListing()
# addrSet = main_func.getBody()
# instructions = listing.getInstructions(addrSet,True)


blocks = bbm.getCodeBlocksContaining(body, monitor)

block = blocks.next()

while block:
    
    print_disassembly(block)
    block = blocks.next()
    print