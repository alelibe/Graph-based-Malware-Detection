# __Graph-based Malware Detection on _Android___

## __Overview__
Among the various mobile operating systems available today, _Android_ has emerged as the most popular. The open architecture and large user base of _Android_ have made it particularly vulnerable to malware attacks, which can have serious consequences for both individuals and organizations. Furthermore, the potential risks of such attacks are only increasing as mobile devices become more integrated into our daily lives and store even more sensitive information. Indeed malware on _Android_ can have a range of negative effects, including financial loss, identity theft, and even physical harm.

We propose a hierarchical graph neural network to build an _Android_ malware detection model. Hierarchical graph representations incorporate inter-function call graph (FCG) and intra-function control flow graphs (CFG) for representing each APK. 

The model was inspired by the research work of [Ling et al., 2017](https://ieeexplore.ieee.org/abstract/document/9796786) who used the same architectur to construct [MalGraph](https://github.com/ryderling/MalGraph/tree/4d5f0f80ab2cf7d55abe35a9ef46686b5fdb9610) a malware detection model for _Windows PE_.

### __Data Preparation__

APK representations using a hierarchical graph combine the _Function Call Graph_ (__FCG__) and the _Control Flow Graph_ (__CFG__). More precisely, an APK is represented by a FCG which has two types of nodes: 
* __External methods__, which will initially be encoded as a one-hot vector based on their method names 
* __Local methods__, which will be represented by the corresponding CFG.

<!-- ![hierchical_structure](images\hierchicalstruc.png) -->
<img src="images\hierchicalstruc.png" width="600" align="center"/>

To achieve this structure, we define a pipeline of operations that includes the following steps:
1. Download the dataset
2. Unzip, extract `.dex` file and analyze `AndroidManifest` for each APK
3. Import the `.dex` files on [Ghidra](https://ghidra-sre.org/) tool
4. Launch [Ghidra](https://ghidra-sre.org/) script to construct FCG and CFGs

<!-- ![hierchical_structure](images\pipeline.png) -->
<img src="images\pipeline.png" width="600" align="center"/>

### __Model__

Our model aims to predict the probability of malicious or benign for a given Android Application. The hierarchical structure that incorporates the inter-function FCG with intra-function CFGs of an Andorid APK is passed as input to the model which will generate the probability for it to be a malware. Image below show the main steps of our approach:

<!-- ![image_model](images\Model.jpg) -->
<img src="images\model.jpg" width="500" align="center"/>

## __Setup__
1. Create a virtual environment running the following code:

```
python -m venv ./venv
```

2. Activate thevirtual environment by executing the script contained in the folder venv

3. Run the installation of requirements

```
pip install -r ./requirements.txt
```

now you are ready to execute the code.

<!-- ## __Quick Start__
TODO:  Main command lines to execute the code e.g. Preprocess the dataset, Train the model, Test it... -->
