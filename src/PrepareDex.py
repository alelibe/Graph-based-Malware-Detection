import os
import math
from Utils.Data import directoryAPKs,pathOutputUnzip,num_core
from Utils.utils_prepareDex import rename_Dex,unzipAPK,decodeManifest,createDirDexFolders


createDirDexFolders()

#Scroll through the apks and unzip them and then decode AndroidManifest.xml file
for apk in os.listdir(directoryAPKs):
    #il path che conterr√† i file dell'apk unzippato
    pathAPK = os.path.join(directoryAPKs, apk).replace("\\","/")
    extension_file = apk.find(".apk")
    app_name = apk[:extension_file]
    pathOutput = os.path.join(pathOutputUnzip, app_name).replace("\\","/")
    unzipAPK(pathAPK,pathOutput)
 
print("-----APK UNZIPPATI-----")

decodeManifest()

print("-----MANIFEST DECODIFICATI-----")


i = 0
for unzip_apk in os.listdir(pathOutputUnzip):
    pathUnzipApk = os.path.join(pathOutputUnzip, unzip_apk).replace("\\","/")
    rename_Dex(pathUnzipApk,unzip_apk,i,num_core)
    i += 1

print("-----DEX SPLITTATI E SALVATI-----")