import json
import pandas as pd
import os
from Utils.config import preprocessedGraphs,external_fun_vocabulary

vocabulary_list = []
freq_name = {"f_name": [],
             "count": []}


for graphs in os.listdir(preprocessedGraphs):
    path_graph = os.path.join(preprocessedGraphs,graphs).replace("\\","/")
    with open(path_graph) as jsonFile:
        preprocess_graph = json.load(jsonFile)


    for func in preprocess_graph["function_names"]:
        if "EXTERNAL" in func:
            # print(func.split("::")[-1])
            func_name = func.split("::")[-1]
            if not func_name in freq_name["f_name"]:
                freq_name["f_name"].append(func_name)
                freq_name["count"].append(1)
            else:
                index_func_name = freq_name["f_name"].index(func_name)
                freq_name["count"][index_func_name] += 1

df = pd.DataFrame(freq_name)

df2 = df.to_json(external_fun_vocabulary,orient = 'records',lines=True)
