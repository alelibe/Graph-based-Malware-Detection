import os
import shutil
import zipfile
from Utils.Data import directoryAPKs,pathOutputUnzip,axmldec,pathDexList


def unzipAPK(pathAPK,pathOutput):
    try:
        with zipfile.ZipFile(pathAPK) as z:
            z.extractall(pathOutput)
    except:
        print("Invalid file", pathAPK)
    

def decodeManifest():
    for apk in os.listdir(directoryAPKs):
        pathAPK = os.path.join(directoryAPKs, apk).replace("\\","/")
        extension_file = apk.find(".apk")
        app_name = apk[:extension_file]
        
        pathOutManifest = os.path.join(pathOutputUnzip, app_name, "AndroidManifest.xml").replace("\\","/")
        command = axmldec + " -o " + pathOutManifest + " " + pathAPK
        os.system(command)
    

def createDirDexFolders():
    for path in pathDexList:
        if not(os.path.exists(path)):
            os.mkdir(path)
                
            
def rename_Dex(pathUnzipApk,name_app,i,partition):
    
    for file in os.listdir(pathUnzipApk):
        if file.endswith(".dex"):
            path_dex_file = os.path.join(pathUnzipApk, file).replace("\\","/")
            new_name = name_app + ".dex"
            path_dex_src = os.path.join(pathUnzipApk, new_name).replace("\\","/")
            os.rename(path_dex_file,path_dex_src)

            partition_index = (i % partition)
            shutil.move(path_dex_src, os.path.join(pathDexList[partition_index],new_name))
        


    




