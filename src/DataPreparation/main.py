from threading import Thread
from concurrent.futures import ProcessPoolExecutor

from Utils.apkNoMainManager import ApkNoMainManager
from Utils.tongManager import TongManager
import time
from Utils.jobs import createDirDexFolders
from Utils.config import pathDexList,sizeShaList
from Utils.workerJobs import work





if __name__ == '__main__': 
    start_time = time.time()

    createDirDexFolders()
    

    apkNoMainManager = ApkNoMainManager()
    tongManager = TongManager(sizeShaList)

    # create a threadpool with num_core threads
    pool = [Thread(target=work, args=[tongManager, apkNoMainManager, core, dexpath]) for core, dexpath in enumerate(pathDexList)]
    for t in pool:
        t.start()

    for t in pool:
        t.join()

    apkNoMainManager.write()
    print("Process finished --- %s seconds ---" % (time.time() - start_time))
    
