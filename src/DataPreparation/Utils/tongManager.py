import csv
from config import tong_path
import threading

class TongManager():

    tong = None
    lock = None

    def __init__(self,n) -> None:
        self.lock = threading.Lock()
        
        with open(tong_path, encoding='utf-8-sig') as f:
            list_sha = list(csv.reader(f))[10702:10703]
            list_sha = [item[1] for item in list_sha]

        self.tong = [list_sha[e:e+n] for e in range(0,len(list_sha),n)]



    def pop(self):
        self.lock.acquire()
        if len(self.tong) != 0:
            sha_apks = self.tong.pop(0)
        else:
            sha_apks = None
        self.lock.release() 
    
        return sha_apks
    

    def push(self,shaListFailed):
        for sha in shaListFailed:
            self.lock.acquire()
            self.tong.append(sha)
            self.lock.release()
    
